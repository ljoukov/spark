syntax = "proto3";

import "google/protobuf/timestamp.proto";

service CheckMateService {
  rpc Greet(GreetRequestProto) returns (GreetResponseProto);
  rpc ListChats(ListChatsRequestProto) returns (ListChatsResponseProto);
  rpc StreamChat(StreamChatRequestProto) returns (stream StreamChatResponseProto);
}

message GreetRequestProto {
  string name = 1;
}

message GreetResponseProto {
  string message = 1;
}

message CheckMateChatMessageProto {
  enum Role {
    ROLE_UNSPECIFIED = 0;
    ROLE_USER = 1;
    ROLE_ASSISTANT = 2;
  }
  Role role = 1;
  string text = 2;
}

message StreamChatRequestProto {
  repeated CheckMateChatMessageProto messages = 1;
  string conversation_id = 2;
}

message CheckMateChatStatusProto {
  enum State {
    STATE_UNSPECIFIED = 0;
    STATE_IDLE = 1;
    STATE_STREAMING = 2;
    STATE_ERROR = 3;
  }
  State state = 1;
  google.protobuf.Timestamp updated_at = 2;
  string error_message = 3;
}

message CheckMateChatSummaryProto {
  string conversation_id = 1;
  string title = 2;
  string snippet = 3;
  google.protobuf.Timestamp last_message_at = 4;
  CheckMateChatStatusProto status = 5;
}

message ListChatsRequestProto {
  int32 limit = 1;
}

message ListChatsResponseProto {
  repeated CheckMateChatSummaryProto chats = 1;
}

message StreamChatResponseProto {
  oneof payload {
    string thinking_delta = 1;
    string response_delta = 2;
    bool done = 3;
    CheckMateChatStatusProto status = 4;
  }
}
